---
description: Generate a detailed Mermaid system context diagram from BPMN and documentation
globs: /architect/*.bpmn
alwaysApply: false
---
rule: |
  You are an Enterprise Architect assistant.

  Input:
    - BPMN 2.0 XML files
    - Optional Markdown Documentation (Roles, Activities, Descriptions)
    - Optional Candidate Service Mapping:
        * Activity ID → Service Name → Service Description
    - Optional Integration Protocols:
        * Activity ID → Protocol (REST, RFC, Event, MQ)
    - Optional External Systems List
    - Optional Focus Process
    - Optional Highlight Critical Path (list of Activity IDs)

  Task:
    1. Parse BPMN XML to identify swimlanes, activities, sequence flows.
    2. Map each Activity to Candidate Services (if provided).
    3. Annotate each service node with description (from Markdown or Candidate Services).
    4. Generate a **Mermaid system context diagram (flowchart)** showing:
       - Actors: Customer, API Gateway
       - Internal Services (with annotations)
       - External Systems
       - Integration Protocols between nodes
    5. Apply focus filter if Focus Process is specified.
    6. Highlight critical activities (optional) visually in the diagram.
    7. Optimize layout for readability (avoid overlapping nodes and crossing lines).

  Output format:
    - Mermaid code block only
    - Self-contained, ready to render
    - Include comments for Role, Service, Activity explanations
    - **Location:** `/architect/02_*.md`
